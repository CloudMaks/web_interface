// main.js - –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (index.html)
document.addEventListener('DOMContentLoaded', function() {
    console.log('üè† –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
    
    initNavigation();
    initAnimations();
    initHeaderEffects();
    updateNavigationForAuth();
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
function initNavigation() {
    // –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —è–∫–æ—Ä—è–º
    const navLinks = document.querySelectorAll('.nav-link');
    
    for (let link of navLinks) {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            
            const targetId = this.getAttribute('href');
            const targetElement = document.querySelector(targetId);
            
            if (targetElement) {
                window.scrollTo({
                    top: targetElement.offsetTop - 80,
                    behavior: 'smooth'
                });
            }
        });
    }
}

// –ê–Ω–∏–º–∞—Ü–∏–∏
function initAnimations() {
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver(function(entries) {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    // –ù–∞–±–ª—é–¥–∞–µ–º –∑–∞ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
    const animatedElements = document.querySelectorAll('.about-card, .feature-item, .scenario-card');
    animatedElements.forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(30px)';
        el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(el);
    });

    // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫ –∫–∞—Ä—Ç–æ—á–∫–∞–º
    const cards = document.querySelectorAll('.about-card, .scenario-card');
    cards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-8px) scale(1.02)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
        });
    });
}

// –≠—Ñ—Ñ–µ–∫—Ç—ã —à–∞–ø–∫–∏
function initHeaderEffects() {
    const header = document.querySelector('.header');
    if (!header) return;

    let lastScrollY = window.scrollY;

    window.addEventListener('scroll', function() {
        if (window.scrollY > 100) {
            header.style.background = 'rgba(15, 23, 42, 0.95)';
            header.style.backdropFilter = 'blur(10px)';
        } else {
            header.style.background = 'var(--bg-secondary)';
            header.style.backdropFilter = 'none';
        }

        lastScrollY = window.scrollY;
    });
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
async function updateNavigationForAuth() {
    try {
        const user = await checkAuthSoft();
        if (user) {
            updateNavigationForLoggedInUser(user);
        }
    } catch (error) {
        console.log('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
    }
}

// –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function updateNavigationForLoggedInUser(user) {
    console.log('üë§ –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –¥–ª—è:', user.name);
    
    const nav = document.querySelector('.nav ul');
    if (!nav) return;
    
    // –ù–∞—Ö–æ–¥–∏–º –∫–Ω–æ–ø–∫—É "–í–æ–π—Ç–∏"
    const loginButton = nav.querySelector('a[href="login.html"]');
    if (loginButton) {
        // –ú–µ–Ω—è–µ–º –Ω–∞ "–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç"
        loginButton.textContent = '–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç';
        loginButton.href = `${user.role}-dashboard.html`;
        loginButton.classList.remove('btn-outline');
        loginButton.classList.add('btn-primary');
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≤—ã—Ö–æ–¥–∞
        const logoutItem = document.createElement('li');
        logoutItem.innerHTML = `
            <a href="#" class="btn btn-outline" onclick="logout(); return false;">
                <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
            </a>
        `;
        nav.appendChild(logoutItem);
    }
}